{% extends "layout.html" %}
{% from "map_rendering.html" import render_map %}
{% block title %}Item {{ item.id }}{% endblock %}
{% block content %}
  {%- if current_user.id -%}
    <button class="btn btn-primary btn-lg pull-right" data-toggle="modal" data-target="#match-modal">Match this item</button>
  {%- endif -%}

  <h2>Mapped Data</h2>
  {{ render_map(item) }}

  <p class="lead"><a href="{{ url_for('frontend.item_links', item_id=item.id) }}">View linked items</a></p>

  <h2>Raw Data</h2>
  <ul style="list-style-type: none; padding: 0">
    {% for id, data in item.data_formatted.iteritems() %}
      <li><h3>{{ id }}</h3>{% highlight 'json' %}{{ data }}{% endhighlight %}</li>
    {% endfor %}
    <li><h3>Raw item map</h3>{%- highlight 'json' %}{{ item.map_formatted }}{% endhighlight -%}</li>
  </ul>

{% endblock %}

{% block hiddencontent %}
{%- if current_user.id -%}
  <div class="modal" id="match-modal" tabindex="-1" role="dialog" aria-labelledby="match-modal-label" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
          <h4 class="modal-title" id="match-modal-label">Match this item to MusicBrainz</h4>
        </div>
        <div class="modal-body">
          <p>This modal should have some fields, which when given MBIDs fetch data from the '/entity' endpoint, passing along the item type (for this entity: {{ item.type }}) as the type hint, and not permitting hitting the cache.</p>
          <p>In doing so, they should seed the database with the cached entity information required such that when the form is ultimately submitted (by posting JSON to the relevant endpoint) the MBIDs will already be there. In part this will mean that upon getting a response from the entity endpoint, the MBID should be replaced with whatever that gives back, in case it's a redirected MBID.</p>
          <p>Somewhere in this dialog should probably show the currently-active match, and something should probably be expandable or otherwise clickable to show the history of matches, when there are historical matches for the item.</p>
        </div>
      </div>
    </div>
  </div>
{%- endif -%}
{% endblock %}
